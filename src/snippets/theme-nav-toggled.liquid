<!-- /snippets/theme-nav-toggled.liquid -->

<nav class="theme-nav-toggled from-left active" id="NavToggled" role="navigation">
  <div class="inner">
    <ul>
      {% for link in linklists.main-menu.links %}
        {% assign child_list_handle = link.title | handleize %}
        {% if linklists[child_list_handle].links != blank %}
          <li class="dropdown" aria-haspopup="true" data-id="{{ child_list_handle}}">
            <span class="dropdown-heading">
              {{ link.title }}
            </span>
            <ul class="dropdown_menu hidden" id="{{ child_list_handle }}">
              {% for childlink in linklists[child_list_handle].links %}
                <li>
                  <a href="{{ childlink.url }}" class="nav-link{% if childlink.active %} active{% endif %}">{{ childlink.title | escape }}</a>
                </li>
              {% endfor %}
            </ul>
          </li>
        {% else %}
          <li class="non_dropdown">
            <a href="{{ link.url }}" class="nav-link{% if link.active %} active{% endif %}">{{ link.title }}</a>
          </li>
        {% endif %}
      {% endfor %}
    </ul>
    <a href="#close" class="nav-toggled-close" aria-label="{{ 'common.close' | t }}">{{ 'common.close' | t }}</a>
  </div>
</nav>

<script>
  //Opens Menu
  $('#MobileNavToggle').click(function(){
    $('#NavToggled').addClass('active');
  });

  //Resets Menu when closed
  $('.nav-toggled-close').click(function(){
    $('#NavToggled').removeClass('active');
    $('#NavToggled .inner').fadeOut(200,function(){
      $('#NavToggled .dropdown-heading.active').each(function(){
        $(this).removeClass('active');
        $(this).next().addClass('hidden');
        $('#NavToggled .dropdown, #NavToggled .non_dropdown').removeClass('hidden');
        $('#NavToggled .inner').fadeIn();
      });
    });
  });

  //Handles Logic for opening sub-menus
  $('#NavToggled .dropdown-heading').click(function(){
    var heading = $(this);
    if(!heading.hasClass('active')){
      $('#NavToggled .inner').fadeOut(200,function(){
        $('#NavToggled .dropdown, #NavToggled .non_dropdown').addClass('hidden');
        heading.addClass('active');
        heading.parent().removeClass('hidden');
        heading.next().removeClass('hidden');
        $('#NavToggled .inner').fadeIn();
      });
    }else{
      $('#NavToggled .inner').fadeOut(200,function(){
        $('#NavToggled .dropdown, #NavToggled .non_dropdown').removeClass('hidden');
          heading.removeClass('active');
          heading.next().addClass('hidden');
        $('#NavToggled .inner').fadeIn();
      });
    }
  });
</script>